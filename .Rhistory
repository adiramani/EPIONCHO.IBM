RSD_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$RSD$ABR_6969)
RSD_ageprev_df_ABR6969 <- data.frame(prev = RSD_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("RSD"))
# RSD_ageprev_ABR41922 <- unlist(modelled_meanageprevvals$RSD$ABR_41922)
# RSD_ageprev_df_ABR41922 <- data.frame(prev = RSD_ageprev_ABR41922, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
#                                                                                        "30 - 49", "50 - 80")), endemicity = as.factor("chesnais"), sequela = as.factor("RSD"))
Atrp_ageprev_ABR294 <- unlist(modelled_meanageprevvals$Atrophy$ABR_294)
Atrp_ageprev_df_ABR294 <- data.frame(prev = Atrp_ageprev_ABR294, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hypo"), sequela = as.factor("atrophy"))
Atrp_ageprev_ABR607 <- unlist(modelled_meanageprevvals$Atrophy$ABR_607)
Atrp_ageprev_df_ABR607 <- data.frame(prev = Atrp_ageprev_ABR607, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("Murdoch et al. 2017
(meso)"), sequela = as.factor("atrophy"))
Atrp_ageprev_ABR1082 <- unlist(modelled_meanageprevvals$Atrophy$ABR_1082)
Atrp_ageprev_df_ABR1082 <- data.frame(prev = Atrp_ageprev_ABR1082, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hyper"), sequela = as.factor("atrophy"))
Atrp_ageprev_ABR2297 <- unlist(modelled_meanageprevvals$Atrophy$ABR_2297)
Atrp_ageprev_df_ABR2297 <- data.frame(prev = Atrp_ageprev_ABR2297, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("very hyper"), sequela = as.factor("atrophy"))
Atrp_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$Atrophy$ABR_6969)
Atrp_ageprev_df_ABR6969 <- data.frame(prev = Atrp_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("atrophy"))
# Atrp_ageprev_ABR41922 <- unlist(modelled_meanageprevvals$Atrophy$ABR_41922)
# Atrp_ageprev_df_ABR41922 <- data.frame(prev = Atrp_ageprev_ABR41922, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
#                                                                                          "30 - 49", "50 - 80")), endemicity = as.factor("chesnais"), sequela = as.factor("atrophy"))
HG_ageprev_ABR294 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_294)
HG_ageprev_df_ABR294 <- data.frame(prev = HG_ageprev_ABR294, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hypo"), sequela = as.factor("hanging groin"))
HG_ageprev_ABR607 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_607)
HG_ageprev_df_ABR607 <- data.frame(prev = HG_ageprev_ABR607, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("Murdoch et al. 2017
(meso)"), sequela = as.factor("hanging groin"))
HG_ageprev_ABR1082 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_1082)
HG_ageprev_df_ABR1082 <- data.frame(prev = HG_ageprev_ABR1082, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hyper"), sequela = as.factor("hanging groin"))
HG_ageprev_ABR2297 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_2297)
HG_ageprev_df_ABR2297 <- data.frame(prev = HG_ageprev_ABR2297, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("very hyper"), sequela = as.factor("hanging groin"))
HG_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_6969)
HG_ageprev_df_ABR6969 <- data.frame(prev = HG_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("hanging groin"))
# HG_ageprev_ABR41922 <- unlist(modelled_meanageprevvals$Hanging_groin$ABR_41922)
# HG_ageprev_df_ABR41922 <- data.frame(prev = HG_ageprev_ABR41922, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
#                                                                                            "30 - 49", "50 - 80")), endemicity = as.factor("chesnais"), sequela = as.factor("hanging groin"))
depigm_ageprev_ABR294 <- unlist(modelled_meanageprevvals$depigmentation$ABR_294)
depigm_ageprev_df_ABR294 <- data.frame(prev = depigm_ageprev_ABR294, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hypo"), sequela = as.factor("depigmentation"))
depigm_ageprev_ABR607 <- unlist(modelled_meanageprevvals$depigmentation$ABR_607)
depigm_ageprev_df_ABR607 <- data.frame(prev = depigm_ageprev_ABR607, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("Murdoch et al. 2017
(meso)"), sequela = as.factor("depigmentation"))
depigm_ageprev_ABR1082 <- unlist(modelled_meanageprevvals$depigmentation$ABR_1082)
depigm_ageprev_df_ABR1082 <- data.frame(prev = depigm_ageprev_ABR1082, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hyper"), sequela = as.factor("depigmentation"))
depigm_ageprev_ABR2297 <- unlist(modelled_meanageprevvals$depigmentation$ABR_2297)
depigm_ageprev_df_ABR2297 <- data.frame(prev = depigm_ageprev_ABR2297, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("very hyper"), sequela = as.factor("depigmentation"))
depigm_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$depigmentation$ABR_6969)
depigm_ageprev_df_ABR6969 <- data.frame(prev = depigm_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("depigmentation"))
# depigm_ageprev_ABR41922 <- unlist(modelled_meanageprevvals$depigmentation$ABR_41922)
# depigm_ageprev_df_ABR41922 <- data.frame(prev = depigm_ageprev_ABR41922, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
#                                                                                        "30 - 49", "50 - 80")), endemicity = as.factor("chesnais"), sequela = as.factor("depigmentation"))
# =========================== #
modelled_ageprev_endemicities50_80 <- rbind(SI_ageprev_df_ABR294, RSD_ageprev_df_ABR294, Atrp_ageprev_df_ABR294, HG_ageprev_df_ABR294, depigm_ageprev_df_ABR294,
SI_ageprev_df_ABR607, RSD_ageprev_df_ABR607, Atrp_ageprev_df_ABR607, HG_ageprev_df_ABR607, depigm_ageprev_df_ABR607,
SI_ageprev_df_ABR1082, RSD_ageprev_df_ABR1082, Atrp_ageprev_df_ABR1082, HG_ageprev_df_ABR1082, depigm_ageprev_df_ABR1082,
SI_ageprev_df_ABR2297, RSD_ageprev_df_ABR2297, Atrp_ageprev_df_ABR2297, HG_ageprev_df_ABR2297, depigm_ageprev_df_ABR2297,
SI_ageprev_df_ABR6969, RSD_ageprev_df_ABR6969, Atrp_ageprev_df_ABR6969, HG_ageprev_df_ABR6969, depigm_ageprev_df_ABR6969)
modelled_ageprev_endemicities50_80$age_cat <- factor(modelled_ageprev_endemicities50_80$age_cat, levels = c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80"))
ggplot(data = modelled_ageprev_endemicities50_80, aes(x = age_cat, y = prev*100, group = interaction(sequela, endemicity), colour = endemicity))+
geom_line()+
facet_wrap(~sequela, scales = "free_y")
library(haven)
murdoch_data <- read_dta('C:/Users/mad206/OneDrive/EPIONCH-IBM BoD/Skin disease/Murdoch data/pntd.0005489.s001 (1).dta')
murdoch_data2 <- murdoch_data[!is.na(murdoch_data$mfbin),]
library(dplyr)
library(binom)
murdoch_data2 <- murdoch_data2 %>%
mutate(
#create categories
age_cat = dplyr::case_when(
age >= 0 & age < 2 ~ "0 - 1",
age >= 2 & age < 5 ~ "2 - 4",
age >= 5 & age < 10 ~ "5 - 9",
age >= 10 & age < 20 ~ "10 - 19",
age >= 20 & age < 30 ~ "20 - 29",
age >= 30 & age < 50 ~ "30 - 49",
age >= 50 & age <= 80 ~ "50 - 80",
age > 80 ~ "> 80"
),
# convert to factor
age_cat = factor(
age_cat,
level = c("0 - 1","2 - 4", "5 - 9", "10 - 19", "20 - 29", "30 - 49", "50 - 80", "> 80")
)
)
murdoch_data2_endemic <- subset(murdoch_data2, mesonon == 1)
murdoch_data2_nonendemic <- subset(murdoch_data2, mesonon == 0)
# SI_prev0_1_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 0 & morb.mat.tmp[,1] < 2)) /  length(which(morb.mat.tmp[,1] >= 0 & morb.mat.tmp[,1] < 2))# 0 - 1 age
# SI_prev2_4_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 2 & morb.mat.tmp[,1] < 5)) /  length(which(morb.mat.tmp[,1] >= 2 & morb.mat.tmp[,1] < 5))# 2 - 4 age
# SI_prev5_9_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 5 & morb.mat.tmp[,1] < 10)) /  length(which(morb.mat.tmp[,1] >= 5 & morb.mat.tmp[,1] < 10))
# SI_prev10_19_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 10 & morb.mat.tmp[,1] < 20)) /  length(which(morb.mat.tmp[,1] >= 10 & morb.mat.tmp[,1] < 20))
# SI_prev20_29_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 20 & morb.mat.tmp[,1] < 30)) /  length(which(morb.mat.tmp[,1] >= 20 & morb.mat.tmp[,1] < 30))
# SI_prev30_49_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 30 & morb.mat.tmp[,1] < 50)) /  length(which(morb.mat.tmp[,1] >= 30 & morb.mat.tmp[,1] < 50))
# SI_prev50_80_temp <- length(which(morb.mat.tmp[,46] == 1 & morb.mat.tmp[,1] >= 50 & morb.mat.tmp[,1] <= 80)) /  length(which(morb.mat.tmp[,1] >= 50 & morb.mat.tmp[,1] < 80))
# ======= #
# atrophy #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
atrp_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(atrophy),
n = n(),
prop = sum(atrophy)/n())
atrp_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(atrophy),
n_nend = n(),
prop_nend = sum(atrophy)/n())
atrp_df <- data.frame(age_cat = atrp_age_prop$age_cat, x_nend = atrp_age_prop_nonend$x_nend, n_nend = atrp_age_prop_nonend$n_nend,
prop_nend = atrp_age_prop_nonend$prop_nend, x = atrp_age_prop$x, n = atrp_age_prop$n, prop = atrp_age_prop$prop)
atrp_df$adj_prop <- atrp_df$prop - atrp_df$prop_nend
atrp_df$adj_prop <- ifelse(atrp_df$adj_prop < 0, 0, atrp_df$adj_prop)
atrp_df$x_adj <- atrp_df$n * atrp_df$adj_prop
atrp_df$x_adj_rnd <- round(atrp_df$x_adj)
atrp_CI <- binom.confint(x = atrp_df$x_adj_rnd, n = atrp_df$n, conf.level = 0.95, methods = "exact")
atrp_df$lower <- atrp_CI$lower
atrp_df$upper <- atrp_CI$upper
atrp_df$prop_check <- atrp_CI$mean
atrp_df$sequela <- as.factor("atrophy")
# remove > 50 yrs categories
# =========== #
# severe itch #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
SI_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(itching),
n = n(),
prop = sum(itching)/n())
SI_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(itching),
n_nend = n(),
prop_nend = sum(itching)/n())
SI_df <- data.frame(age_cat = SI_age_prop$age_cat, x_nend = SI_age_prop_nonend$x_nend, n_nend = SI_age_prop_nonend$n_nend,
prop_nend = SI_age_prop_nonend$prop_nend, x = SI_age_prop$x, n = SI_age_prop$n, prop = SI_age_prop$prop)
SI_df$adj_prop <- SI_df$prop - SI_df$prop_nend
SI_df$adj_prop <- ifelse(SI_df$adj_prop < 0, 0, SI_df$adj_prop)
SI_df$x_adj <- SI_df$n * SI_df$adj_prop
SI_df$x_adj_rnd <- round(SI_df$x_adj)
SI_CI <- binom.confint(x = SI_df$x_adj_rnd, n = SI_df$n, conf.level = 0.95, methods = "exact")
SI_df$lower <- SI_CI$lower
SI_df$upper <- SI_CI$upper
SI_df$prop_check <- SI_CI$mean
SI_df$sequela <- as.factor("severe itching")
# =========== #
# APOD       #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
APOD_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(apod),
n = n(),
prop = sum(apod)/n())
APOD_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(apod),
n_nend = n(),
prop_nend = sum(apod)/n())
APOD_df <- data.frame(age_cat = APOD_age_prop$age_cat, x_nend = APOD_age_prop_nonend$x_nend, n_nend = APOD_age_prop_nonend$n_nend,
prop_nend = APOD_age_prop_nonend$prop_nend, x = APOD_age_prop$x, n = APOD_age_prop$n, prop = APOD_age_prop$prop)
APOD_df$adj_prop <- APOD_df$prop - APOD_df$prop_nend
APOD_df$adj_prop <- ifelse(APOD_df$adj_prop < 0, 0, APOD_df$adj_prop)
APOD_df$x_adj <- APOD_df$n * APOD_df$adj_prop
APOD_df$x_adj_rnd <- round(APOD_df$x_adj)
APOD_CI <- binom.confint(x = APOD_df$x_adj_rnd, n = APOD_df$n, conf.level = 0.95, methods = "exact")
APOD_df$lower <- APOD_CI$lower
APOD_df$upper <- APOD_CI$upper
APOD_df$prop_check <- APOD_CI$mean
#APOD_df$sequela1 <- as.factor("APOD")
APOD_df$sequela <- as.factor("RSD")
# =========== #
# CPOD       #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
CPOD_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(cpod),
n = n(),
prop = sum(cpod)/n())
CPOD_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(cpod),
n_nend = n(),
prop_nend = sum(cpod)/n())
CPOD_df <- data.frame(age_cat = CPOD_age_prop$age_cat, x_nend = CPOD_age_prop_nonend$x_nend, n_nend = CPOD_age_prop_nonend$n_nend,
prop_nend = CPOD_age_prop_nonend$prop_nend, x = CPOD_age_prop$x, n = CPOD_age_prop$n, prop = CPOD_age_prop$prop)
CPOD_df$adj_prop <- CPOD_df$prop - CPOD_df$prop_nend
CPOD_df$adj_prop <- ifelse(CPOD_df$adj_prop < 0, 0, CPOD_df$adj_prop)
CPOD_df$x_adj <- CPOD_df$n * CPOD_df$adj_prop
CPOD_df$x_adj_rnd <- round(CPOD_df$x_adj)
CPOD_CI <- binom.confint(x = CPOD_df$x_adj_rnd, n = CPOD_df$n, conf.level = 0.95, methods = "exact")
CPOD_df$lower <- CPOD_CI$lower
CPOD_df$upper <- CPOD_CI$upper
CPOD_df$prop_check <- CPOD_CI$mean
#CPOD_df$sequela1 <- as.factor("CPOD")
CPOD_df$sequela <- as.factor("RSD")
# =========== #
#   LOD       #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
LOD_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(lod),
n = n(),
prop = sum(lod)/n())
LOD_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(lod),
n_nend = n(),
prop_nend = sum(lod)/n())
LOD_df <- data.frame(age_cat = LOD_age_prop$age_cat, x_nend = LOD_age_prop_nonend$x_nend, n_nend = LOD_age_prop_nonend$n_nend,
prop_nend = LOD_age_prop_nonend$prop_nend, x = LOD_age_prop$x, n = LOD_age_prop$n, prop = LOD_age_prop$prop)
LOD_df$adj_prop <- LOD_df$prop - LOD_df$prop_nend
LOD_df$adj_prop <- ifelse(LOD_df$adj_prop < 0, 0, LOD_df$adj_prop)
LOD_df$x_adj <- LOD_df$n * LOD_df$adj_prop
LOD_df$x_adj_rnd <- round(LOD_df$x_adj)
LOD_CI <- binom.confint(x = LOD_df$x_adj_rnd, n = LOD_df$n, conf.level = 0.95, methods = "exact")
LOD_df$lower <- LOD_CI$lower
LOD_df$upper <- LOD_CI$upper
LOD_df$prop_check <- LOD_CI$mean
#LOD_df$sequela1 <- as.factor("LOD")
LOD_df$sequela <- as.factor("RSD")
# =========== #
#   RSD       #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
murdoch_data2_endemic$rsd <- ifelse(murdoch_data2_endemic$apod == 1 | murdoch_data2_endemic$cpod == 1 | murdoch_data2_endemic$lod == 1, 1, 0)
murdoch_data2_nonendemic$rsd <- ifelse(murdoch_data2_nonendemic$apod == 1 | murdoch_data2_nonendemic$cpod == 1 | murdoch_data2_nonendemic$lod == 1, 1, 0)
RSD_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(rsd),
n = n(),
prop = sum(rsd)/n())
RSD_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(rsd),
n_nend = n(),
prop_nend = sum(rsd)/n())
RSD_df <- data.frame(age_cat = RSD_age_prop$age_cat, x_nend = RSD_age_prop_nonend$x_nend, n_nend = RSD_age_prop_nonend$n_nend,
prop_nend = RSD_age_prop_nonend$prop_nend, x = RSD_age_prop$x, n = RSD_age_prop$n, prop = RSD_age_prop$prop)
RSD_df$adj_prop <- RSD_df$prop - RSD_df$prop_nend
RSD_df$adj_prop <- ifelse(RSD_df$adj_prop < 0, 0, RSD_df$adj_prop)
RSD_df$x_adj <- RSD_df$n * RSD_df$adj_prop
RSD_df$x_adj_rnd <- round(RSD_df$x_adj)
RSD_CI <- binom.confint(x = RSD_df$x_adj_rnd, n = RSD_df$n, conf.level = 0.95, methods = "exact")
RSD_df$lower <- RSD_CI$lower
RSD_df$upper <- RSD_CI$upper
RSD_df$prop_check <- RSD_CI$mean
RSD_df$sequela <- as.factor("RSD")
# ===================== #
#   hanging groin       #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
HG_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(hanggroin),
n = n(),
prop = sum(hanggroin)/n())
HG_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(hanggroin),
n_nend = n(),
prop_nend = sum(hanggroin)/n())
HG_df <- data.frame(age_cat = HG_age_prop$age_cat, x_nend = HG_age_prop_nonend$x_nend, n_nend = HG_age_prop_nonend$n_nend,
prop_nend = HG_age_prop_nonend$prop_nend, x = HG_age_prop$x, n = HG_age_prop$n, prop = HG_age_prop$prop)
HG_df$adj_prop <- HG_df$prop - HG_df$prop_nend
HG_df$adj_prop <- ifelse(HG_df$adj_prop < 0, 0, HG_df$adj_prop)
HG_df$x_adj <- HG_df$n * HG_df$adj_prop
HG_df$x_adj_rnd <- round(HG_df$x_adj)
HG_CI <- binom.confint(x = HG_df$x_adj_rnd, n = HG_df$n, conf.level = 0.95, methods = "exact")
HG_df$lower <- HG_CI$lower
HG_df$upper <- HG_CI$upper
HG_df$prop_check <- HG_CI$mean
HG_df$sequela <- as.factor("hanging groin")
# ===================== #
#   depigmentation      #
#meso <- subset(murdoch_data2, atrophy == 1 & age < 50 & mesonon == 1)
# atrp_age_prop_test <- murdoch_data2_endemic %>%
#   group_by(atrophy, age_cat) %>%
#   summarise(n = n()) %>%
#   mutate(freq = n / sum(n))
depigm_age_prop <- murdoch_data2_endemic %>%
group_by(age_cat) %>%
summarise(x = sum(hypo),
n = n(),
prop = sum(hypo)/n())
depigm_age_prop_nonend <- murdoch_data2_nonendemic %>%
group_by(age_cat) %>%
summarise(x_nend = sum(hypo),
n_nend = n(),
prop_nend = sum(hypo)/n())
depigm_df <- data.frame(age_cat = depigm_age_prop$age_cat, x_nend = depigm_age_prop_nonend$x_nend, n_nend = depigm_age_prop_nonend$n_nend,
prop_nend = depigm_age_prop_nonend$prop_nend, x = depigm_age_prop$x, n = depigm_age_prop$n, prop = depigm_age_prop$prop)
depigm_df$adj_prop <- depigm_df$prop - depigm_df$prop_nend
depigm_df$adj_prop <- ifelse(depigm_df$adj_prop < 0, 0, depigm_df$adj_prop)
depigm_df$x_adj <- depigm_df$n * depigm_df$adj_prop
depigm_df$x_adj_rnd <- round(depigm_df$x_adj)
depigm_CI <- binom.confint(x = depigm_df$x_adj_rnd, n = depigm_df$n, conf.level = 0.95, methods = "exact")
depigm_df$lower <- depigm_CI$lower
depigm_df$upper <- depigm_CI$upper
depigm_df$prop_check <- depigm_CI$mean
depigm_df$sequela <- as.factor("depigmentation")
# ========================= #
#   combine all and plot    #
sequela_df_ageprev <- rbind(SI_df, RSD_df, atrp_df, HG_df, depigm_df)
sequela_df_ageprev_subset <- subset(sequela_df_ageprev, age_cat != "> 80")
APOD_df1 <- subset(APOD_df, age_cat != "> 80")
CPOD_df1 <- subset(CPOD_df, age_cat != "> 80")
LOD_df1 <- subset(LOD_df, age_cat != "> 80")
# sequela_df_ageprev <- rbind(SI_df, RSD_df, APOD_df, CPOD_df, LOD_df, atrp_df, HG_df, depigm_df)
#
# sequela_df_ageprev_subset <- subset(sequela_df_ageprev, age_cat != "> 80")
require(ggplot2)
base_plot <- ggplot(data = sequela_df_ageprev_subset, aes(x = age_cat, y = adj_prop*100, group = sequela))+
geom_line()+
geom_point()+
geom_errorbar(aes(ymin=lower*100, ymax=upper*100), width = 0.2)+
facet_wrap(~sequela)+
theme_bw()
base_plot_APOD <- base_plot +
geom_line(data = APOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "brown", alpha = 0.5)+
geom_point(data = APOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "brown", alpha = 0.5)+
geom_errorbar(data = APOD_df1, aes(ymin=lower*100, ymax=upper*100), width = 0.2, colour = "brown", alpha = 0.5)+
facet_wrap(~sequela)
base_plot_CPOD <- base_plot_APOD +
geom_line(data = CPOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "purple", alpha = 0.5)+
geom_point(data = CPOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "purple", alpha = 0.5)+
geom_errorbar(data = CPOD_df1, aes(ymin=lower*100, ymax=upper*100), width = 0.2, colour = "purple", alpha = 0.5)+
facet_wrap(~sequela)
base_plot_CPOD +
geom_line(data = LOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "orange", alpha = 0.5)+
geom_point(data = LOD_df1, aes(x = age_cat, y = adj_prop*100, group = sequela), colour = "orange", alpha = 0.5)+
geom_errorbar(data = LOD_df1, aes(ymin=lower*100, ymax=upper*100), width = 0.2, colour = "orange", alpha = 0.5)+
ylab("Adjusted prevalence (%)")+
xlab("Age categories (years)")+
facet_wrap(~sequela)
modelled_data <- ggplot()+
geom_line(data = modelled_ageprev_endemicities50_80, aes(x = age_cat, y = prev*100, group=interaction(sequela, endemicity), colour = endemicity))+
facet_wrap(~sequela)
modelled_data +
#geom_line()+
geom_point(data = sequela_df_ageprev_subset, aes(x = age_cat, y = adj_prop*100, group = sequela))+
geom_errorbar(data = sequela_df_ageprev_subset, aes(x = age_cat, y = adj_prop*100, ymin=lower*100, ymax=upper*100), width = 0.2)+
facet_wrap(~sequela, scales = "free_y")+
ylab("prevalence (%)")+
xlab("Age categories (years)")+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, vjust = 0.4, hjust=0.35))
Blind_ageprev_ABR294 <- unlist(modelled_meanageprevvals$blindness$ABR_294)
Blind_ageprev_df_ABR294 <- data.frame(prev = Blind_ageprev_ABR294, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hypo"), sequela = as.factor("blindness"))
Blind_ageprev_ABR607 <- unlist(modelled_meanageprevvals$blindness$ABR_607)
Blind_ageprev_df_ABR607 <- data.frame(prev = Blind_ageprev_ABR607, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("meso"), sequela = as.factor("blindness"))
Blind_ageprev_ABR1082 <- unlist(modelled_meanageprevvals$blindness$ABR_1082)
Blind_ageprev_df_ABR1082 <- data.frame(prev = Blind_ageprev_ABR1082, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hyper"), sequela = as.factor("blindness"))
Blind_ageprev_ABR2297 <- unlist(modelled_meanageprevvals$blindness$ABR_2297)
Blind_ageprev_df_ABR2297 <- data.frame(prev = Blind_ageprev_ABR2297, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("very hyper"), sequela = as.factor("blindness"))
Blind_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$blindness$ABR_6969)
Blind_ageprev_df_ABR6969 <- data.frame(prev = Blind_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("blindness"))
VI_ageprev_ABR294 <- unlist(modelled_meanageprevvals$visual_impairment$ABR_294)
VI_ageprev_df_ABR294 <- data.frame(prev = VI_ageprev_ABR294, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hypo"), sequela = as.factor("visual impairment"))
VI_ageprev_ABR607 <- unlist(modelled_meanageprevvals$visual_impairment$ABR_607)
VI_ageprev_df_ABR607 <- data.frame(prev = VI_ageprev_ABR607, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("meso"), sequela = as.factor("visual impairment"))
VI_ageprev_ABR1082 <- unlist(modelled_meanageprevvals$visual_impairment$ABR_1082)
VI_ageprev_df_ABR1082 <- data.frame(prev = VI_ageprev_ABR1082, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("hyper"), sequela = as.factor("visual impairment"))
VI_ageprev_ABR2297 <- unlist(modelled_meanageprevvals$visual_impairment$ABR_2297)
VI_ageprev_df_ABR2297 <- data.frame(prev = VI_ageprev_ABR2297, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("very hyper"), sequela = as.factor("visual impairment"))
VI_ageprev_ABR6969 <- unlist(modelled_meanageprevvals$visual_impairment$ABR_6969)
VI_ageprev_df_ABR6969 <- data.frame(prev = VI_ageprev_ABR6969, age_cat = as.factor(c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80")), endemicity = as.factor("holo"), sequela = as.factor("visual impairment"))
modelled_ageprev_endemicities50_80 <- rbind(Blind_ageprev_df_ABR294, VI_ageprev_df_ABR294,
Blind_ageprev_df_ABR607, VI_ageprev_df_ABR607,
Blind_ageprev_df_ABR1082, VI_ageprev_df_ABR1082,
Blind_ageprev_df_ABR2297, VI_ageprev_df_ABR2297,
Blind_ageprev_df_ABR6969, VI_ageprev_df_ABR6969)
modelled_ageprev_endemicities50_80$age_cat <- factor(modelled_ageprev_endemicities50_80$age_cat, levels = c("0 - 1", "2 - 4", "5 - 9", "10 - 19", "20 - 29",
"30 - 49", "50 - 80"))
ggplot()+
geom_line(data = modelled_ageprev_endemicities50_80, aes(x = age_cat, y = prev*100, group=interaction(sequela, endemicity), colour = endemicity))+
facet_wrap(~sequela, scales = "free_y")+
ylab("prevalence (%)")+
xlab("Age categories (years)")+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, vjust = 0.4, hjust=0.35))
ggplot()+
geom_line(data = modelled_ageprev_endemicities50_80, aes(x = age_cat, y = prev*100, group=interaction(sequela, endemicity), colour = endemicity))+
facet_wrap(~sequela, scales = "free_y")+
facet_wrap(~sequela)+
ylab("prevalence (%)")+
xlab("Age categories (years)")+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, vjust = 0.4, hjust=0.35))
# prev runs from cluster - with blindness #
modelled_meanprevvals <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_meanval_allmorbidity.rds")
View(modelled_meanageprevvals)
modelled_meanprevruns <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_prev_means_morbidity.rds")
View(modelled_meanageprevvals)
View(modelled_meanprevvals)
# prev runs from cluster - with blindness #
modelled_meanprevvals <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_meanval_allmorbidity.rds")
View(modelled_meanprevvals)
# # age-prev runs from cluster #
modelled_ageprev <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_meanval_allmorbidity_ageprev.rds")
View(modelled_ageprev)
View(modelled_meanprevvals)
mean_prevvals <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_meanval_allmorbidity.rds")
View(mean_prevvals)
# ================================================================================== #
# to work out length of each run (this should be the same as the epi script inputs)
DT.in <- 1/366 #timestep must be one day
treat.len <- 25 #treatment duration in years
treat.strt  = round(100 / (DT.in ))
treat.stp = treat.strt + round(treat.len / (DT.in )) #treatment start and stop
timesteps = treat.stp + round(0/ (DT.in )) #final duration (25 years with no interventions)
# time.its <- round(time.its / (DT))
# timesteps <- 100
# ========================================================== #
# specify certain objects for loop (not previously specified)
model_its <- timesteps # this should be number of timesteps (length of model output)
model_its_blind <- timesteps + 731
repeats   <- 1000 # this should be number of times repeat a par combo (e.g., 100)
#repeats   <- 3 # this should be number of times repeat a par combo (e.g., 100)
#number_repeats <- 3 # or this ? (same as repeats)
number_repeats <- 1000
# ========================================================= #
# repeat this text from the epi script (to get number of iters for parameter combos)
# 1) specify vector of parameter values to test & vector for iterations/repeats  #
abr30 = 294 # 30% mf prev
abr50 = 607 # 50% mf prev
abr60 = 1082 # 60% mf prev
abr70 = 2297 # 70% mf prev
abr80 = 6969 # 80% mf prev
#abr_ches = 41922 # chesnais ABR
abr <- c(abr30, abr50, abr60, abr70, abr80)
num_repeats_each_ABR <- 1000 # number of times repeat each ABR input
#num_repeats_each_ABR <- 3 # number of times repeat each ABR input
tot_abr <- rep(abr, each = num_repeats_each_ABR) # vector of all ABR values to test
k_e <- c(0.3)
num_par_combos <- length(abr) * length(k_e) # number of combos to make ind_rep
inds_reps <- rep(seq(1, num_repeats_each_ABR), num_par_combos) # 2) specify number of TOTAL iterations required: number of repeats for each ABR ( 1- 3), with 4 combos (ABR x k_e pars)  #
# so this is (indice repeating sequence length of total number of iters)
#pathz <- c("/rds/general/user/mad206/home/original_model/rfils/run_") # this path to model outputs doesnt change
pathz <- c("/rds/general/user/mad206/home/morbidity/rfils/murdoch_OSD_update/run_") # this path to model outputs doesnt change
timesteps/366
DT.in <- 1/366 #timestep must be one day
treat.len <- 0 #treatment duration in years
treat.strt  = round(100 / (DT.in ))
treat.stp = treat.strt + round(treat.len / (DT.in )) #treatment start and stop
timesteps = treat.stp + round(0/ (DT.in )) #final duration (25 years with no interventions)
timesteps/366
DT.in <- 1/366 #timestep must be one day
treat.len <- 0 #treatment duration in years
treat.strt  = round(100 / (DT.in ))
treat.stp = treat.strt + round(treat.len / (DT.in )) #treatment start and stop
timesteps = treat.stp + round(0/ (DT.in )) #final duration (25 years with no interventions)
# time.its <- round(time.its / (DT))
# timesteps <- 100
# ========================================================== #
# specify certain objects for loop (not previously specified)
model_its <- timesteps # this should be number of timesteps (length of model output)
model_its_blind <- timesteps + 731
repeats   <- 1000 # this should be number of times repeat a par combo (e.g., 100)
#repeats   <- 3 # this should be number of times repeat a par combo (e.g., 100)
#number_repeats <- 3 # or this ? (same as repeats)
number_repeats <- 1000
model_its_blind/366
model_its/366
mean_prevvals <- readRDS("C:/Users/mad206/OneDrive - Imperial College London/NTD-MC current/EPIONCH-IBM BoD/Blindness code/mean model runs/saved_run_meanval_allmorbidity.rds")
View(mean_prevvals)
